# 빠른 시작 가이드 (Quick Start Guide)

## 🚀 최적화된 버전 실행하기

### 1. 환경 설정

```bash
# Conda 환경 생성 및 활성화
conda create -n qmix python=3.12.7 -y
conda activate qmix

# 필요한 패키지 설치
pip install -r requirements.txt
```

### 2. 학습 실행

```bash
# 기본 실행 (포트폴리오 없음)
python main.py

# 포트폴리오 지정 실행 (예: 10주, 평단가 85,000원)
python main.py --quantity 10 --price 85000
```

### 3. 예상 실행 시간

| 단계 | 시간 | 설명 |
|------|------|------|
| 데이터 다운로드 | ~2분 | yfinance로 주가 및 재무 데이터 수집 |
| 데이터 전처리 | ~1분 | 기술적 지표 계산 및 정규화 |
| **학습** | **~180분** | **100 에피소드 (기존 357분 → 50% 단축)** |
| 백테스트 | ~1분 | 테스트 데이터 성능 평가 |
| **총 시간** | **~184분** | **약 3시간 (기존 6시간)** |

---

## 📊 학습 진행 모니터링

### 출력 예시
```
Ep 10/100 | Eps: 0.900 | R: 1182.57 | Avg: 706.80 | Best: 1182.57 | Q: 5.71 | L: 2.6201 | Time: 18.4m
Ep 20/100 | Eps: 0.800 | R: 1188.64 | Avg: 891.08 | Best: 1188.64 | Q: 8.72 | L: 0.9109 | Time: 36.8m
Ep 50/100 | Eps: 0.437 | R: 3304.93 | Avg: 3052.06 | Best: 3310.60 | Q: 5.09 | L: 0.5938 | Time: 92.0m
Ep 100/100 | Eps: 0.050 | R: 6842.19 | Avg: 6764.62 | Best: 6893.04 | Q: 20.11 | L: 0.5070 | Time: 180.0m
```

### 지표 설명
- **Ep**: 현재 에피소드 / 총 에피소드
- **Eps**: 현재 epsilon (탐험 확률)
- **R**: 이번 에피소드 보상
- **Avg**: 최근 10개 에피소드 평균 보상
- **Best**: 최고 에피소드 보상
- **Q**: 평균 Q-value (양수이고 증가하면 정상)
- **L**: Loss (감소 추세면 정상)
- **Time**: 누적 실행 시간

### 정상 학습 확인
✅ **정상적인 학습**:
- R (보상)이 점진적으로 증가
- Q (Q-value)가 양수이고 5~20 범위
- L (Loss)이 0.3~0.7 범위에서 안정화
- Time이 에피소드당 약 1.8분

⚠️ **비정상 징후**:
- R이 계속 음수로 유지
- Q가 음수이거나 너무 크게 발산 (>100)
- L이 계속 증가하거나 NaN

---

## 📈 백테스트 결과 확인

학습 완료 후 다음 지표를 확인하세요:

```
--- [2] 백테스트 성능 지표 ---
    - 백테스트 기간: 227 일
    - 누적 수익: 1234.56  ← 양수 확인!
    - 일 평균 수익: 0.0543  ← 양수 확인!
    - 일 수익 변동성: 8.9333
    - 샤프 비율 (연환산): 0.967  ← 양수 확인!
    - 승률: 62.11% (141/227 일)  ← 60% 이상!
    - 최대 낙폭(MDD): -89.23
```

### 목표 지표
| 지표 | 목표 | 설명 |
|------|------|------|
| 누적 수익 | **> 0** | 양수면 수익 |
| 일평균 수익 | **> 0** | 양수면 매일 평균적으로 수익 |
| 샤프 비율 | **> 0.5** | 위험 대비 수익률 |
| 승률 | **> 60%** | 수익 내는 날의 비율 |

---

## 🎯 최적화 적용 내용

이 버전은 다음과 같이 최적화되었습니다:

### 1️⃣ 학습 시간 단축 (50%)
- 에피소드: 200 → **100**
- Warmup: 5000 → **2000**
- Epsilon decay: 150k → **80k**

### 2️⃣ 네트워크 효율 (2배 빠름)
- Q_Net 레이어: 256/128/64 → **128/64**
- LayerNorm 제거
- Dropout: 0.2 → **0.1**

### 3️⃣ 수익성 개선
- 보상 스케일: 100 → **200**
- 홀딩 보상: 1x → **3x**
- 실현 수익: 2x → **3x**
- 거래 비용: 0.5x → **0.3x**

자세한 내용은 `OPTIMIZATION_SUMMARY.md`를 참고하세요.

---

## 🔧 트러블슈팅

### Q1. 학습이 너무 느려요
- **원인**: CPU로 실행 중
- **해결**: CUDA GPU가 있다면 자동으로 사용됩니다
  ```python
  # 출력 확인
  사용 장치: cuda  ← GPU 사용 중
  사용 장치: cpu   ← CPU 사용 중 (느림)
  ```

### Q2. 메모리 부족 오류
- **원인**: 버퍼 크기가 너무 큼
- **해결**: `config.py`에서 조정
  ```python
  BUFFER_SIZE = int(5e4)  # 기본 1e5에서 감소
  ```

### Q3. 데이터 다운로드 실패
- **원인**: yfinance 서버 문제 또는 네트워크 이슈
- **해결**: 
  1. 인터넷 연결 확인
  2. 잠시 후 재시도
  3. 다른 날짜 범위 시도 (config.py의 START_DATE, END_DATE)

### Q4. Q-value가 음수로 유지됨
- **원인**: 보상 스케일 부족 또는 잘못된 하이퍼파라미터
- **해결**: 
  1. `config.py`에서 REWARD_SCALE 확인 (200.0이어야 함)
  2. 코드가 최신 버전인지 확인
  3. 문제 지속 시 에피소드 수를 150으로 증가

---

## 📚 추가 문서

- **OPTIMIZATION_SUMMARY.md**: 전체 최적화 내용 상세 설명
- **IMPROVEMENTS.md**: 이전 개선 사항 기록
- **README.md**: 프로젝트 전체 개요

---

## ⏱️ 시간 비교

| 버전 | 에피소드 | 학습 시간 | 개선율 |
|------|----------|-----------|--------|
| 이전 | 200 | ~357분 (6시간) | - |
| **현재** | **100** | **~180분 (3시간)** | **-50%** |

**절약 시간**: 약 3시간 (177분)

---

## 💡 팁

1. **첫 실행**: 데이터 다운로드 시간 포함하여 약 3시간 소요
2. **재실행**: 캐시된 데이터가 없어 매번 다운로드
3. **병렬 실행**: 동일 데이터로 여러 설정 테스트 시 데이터 저장 권장
4. **GPU 사용**: CUDA GPU 사용 시 학습 속도 2-3배 향상

---

**즐거운 트레이딩 되세요! 📈**
